# IndexedDB

## 简介

IndexedDB 是一种底层 API，用于在客户端存储大量的结构化数据（也包括文件/二进制大型对象（blobs）），它使用索引实现对数据的高性能搜索

> **Web 存储方式**
> 会话期 Cookie
> 持久性 Cookie
> SessionStorage
> LocalStorage
> IndexedDB
> WebSQL（已废弃）

## 使用场景

* 数据可视化等
* 即时聊天工具
* 其他存储方式不满足

## 特点

* 非关系型数据库(NoSql)
* 持久化存储
* 异步操作
* 支持事务
* 同源策略
* 存储容量大

## 主要概念

* **仓库** `objectStore`
  类似于“表”
* **索引** `index`
  通过索引来筛选结果
* **游标** `cursor`
  类似于“指针”
* **事务**

## 实际操作

### 创建数据库

将创建数据库的操作封装成了一个函数，并且该函数返回一个promise对象，使得在调用的时候可以链式调用，函数主要接收两个参数：数据库名称、数据库版本

函数内部主要有三个回调函数，分别是：

onsuccess：数据库打开成功或者创建成功后的回调，这里我们将数据库实例返回了出去
onerror：数据库打开或创建失败后的回调
onupgradeneeded：当数据库版本有变化的时候会执行该函数，比如我们想创建新的存储库（表），就可以在该函数里面操作，更新数据库版本即可

### 插入数据

IndexedDB插入数据需要通过事务来进行操作，利用IndexedDB提供的add方法，将插入数据的操作封装成了一个函数，接收三个参数，分别如下：

db：在创建或连接数据库时，返回的db实例，需要那个时候保存下来。
storeName：仓库名称(或者表名)，在创建或连接数据库时我们就已经创建好了仓库。
data：需要插入的数据，通常是一个对象

### 通过主键读取数据

主键即刚刚我们在创建数据库时声明的keyPath，通过主键只能查询出一条数据

### 通过游标查询数据

开启了一个游标，然后逐行读取数据

### 通过索引查询数据

索引名称即我们创建仓库的时候创建的索引名称，也就是键值对中的键，最终会查询出所有满足我们传入函数索引值的数据

### 通过索引和游标查询数据

利用索引和游标结合查询，我们可以查询出索引值满足我们传入函数值的所有数据对象，而不是之查询出一条数据或者所有数据

### 通过索引和游标分页查询

### 更新数据

直接使用put方法，值得注意的是如果数据库中没有该条数据，则会默认增加该条数据，否则更新

### 通过主键删除数据

只能删除一条数据，必须传入主键

### 通过索引和游标删除指定数据

可以删除一条数据（索引值唯一）或者所有满足条件的数据（索引值不唯一）

### 关闭数据库

数据库操作完毕后，建议关闭数据库

### 删除数据库

删库跑路

## 参考资料

* [前端本地存储数据库IndexedDB完整教程](https://juejin.cn/post/7026900352968425486)
